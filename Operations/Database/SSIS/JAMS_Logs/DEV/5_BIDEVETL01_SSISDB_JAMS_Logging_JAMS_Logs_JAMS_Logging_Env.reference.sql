/*
Script Name: H:\My SQL Code\Deployment Scripts\BIDEVETL01\JAMS_Logging\
Generated From Catalog Instance: BIDEVETL01
Catalog Name: SSISDB
Folder Name: JAMS_Logging
Project Name: JAMS_Logs
Reference Name: JAMS_Logging/JAMS_Logging_Env
Environment Name: JAMS_Logging_Env
Generated By: TRG\jgabe
Generated Date: 5/7/2018 1:54:49 PM
Generated From: CatalogBase v2.0.2.0 executing on: JGABEL-LAP1
*/


 -- SSISDB\JAMS_Logging\JAMS_Logs\[.|JAMS_Logging/JAMS_Logging_Env]
print 'Script Name: H:\My SQL Code\Deployment Scripts\BIDEVETL01\JAMS_Logging\
Generated From Catalog Instance: BIDEVETL01
Catalog Name: SSISDB
Folder Name: JAMS_Logging
Project Name: JAMS_Logs
Reference Name: JAMS_Logging/JAMS_Logging_Env
Environment Name: JAMS_Logging_Env
Generated By: TRG\jgabe
Generated Date: 5/7/2018 1:54:49 PM
Generated From: CatalogBase v2.0.2.0 executing on: JGABEL-LAP1'
print ''
print '------------------------------------------------------------'
print 'Deployed to Instance: ' + @@servername
print 'Deploy Date: ' + Convert(varchar,GetDate(), 101) + ' ' + Convert(varchar,GetDate(), 108)
print 'Deployed By: ' + original_login()
print '------------------------------------------------------------'
print ''
declare @ErrMsg varchar(100) 
print 'Check for folder: JAMS_Logging ' 
If Not Exists(Select name 
              From SSISDB.[catalog].folders 
              Where name = N'JAMS_Logging') 
 begin 
  set @ErrMsg = ' - JAMS_Logging does not exist.' 
  raisError(@ErrMsg, 16, 1) 
  return 
 end 
Else 
 begin 
  print ' - JAMS_Logging folder exists.' 
 end 
print '' 
 
print 'Check for project: JAMS_Logs ' 
If Not Exists(Select name 
              From SSISDB.[catalog].projects 
              Where name = N'JAMS_Logs') 
 begin 
  set @ErrMsg = ' - JAMS_Logs project does not exist.' 
  raisError(@ErrMsg, 16, 1) 
  return 
 end 
Else 
 begin 
  print ' - JAMS_Logs project exists.' 
 end 
print '' 
 
 
print 'Check for environment: JAMS_Logging_Env ' 
If Not Exists(Select name 
              From SSISDB.[catalog].environments 
              Where name = N'JAMS_Logging_Env') 
 begin 
  set @ErrMsg = ' - JAMS_Logging_Env environment does not exist.' 
  raisError(@ErrMsg, 16, 1) 
  return 
 end 
Else 
 begin 
  print ' - JAMS_Logging_Env environment exists.' 
 end 
print '' 
 
print 'Reference SSISDB\JAMS_Logging\JAMS_Logs\[.|JAMS_Logging/JAMS_Logging_Env]'
If Not Exists(Select * 
              From SSISDB.[catalog].environment_references er 
              Join SSISDB.[catalog].projects cp 
                On cp.project_id = er.project_id 
              Join SSISDB.[catalog].folders cf 
                On cf.folder_id = cp.folder_id 
              Where cf.name = N'JAMS_Logging'
                And cp.name = N'JAMS_Logs'
                And er.environment_name = N'JAMS_Logging_Env'
                And er.environment_folder_name Is NULL)
 begin
  print ' - Creating Reference SSISDB\JAMS_Logging\JAMS_Logs\[.|JAMS_Logging/JAMS_Logging_Env]'
  Declare @reference_id bigint 
  Exec [SSISDB].[catalog].[create_environment_reference] 
       @environment_name = N'JAMS_Logging_Env' 
     , @reference_id = @reference_id OUTPUT 
     , @project_name = N'JAMS_Logs' 
     , @folder_name = N'JAMS_Logging' 
     , @environment_folder_name = NULL
     , @reference_type = R 
  print ' - Reference SSISDB\JAMS_Logging\JAMS_Logs\[.|JAMS_Logging/JAMS_Logging_Env] created'
 end
else print ' - Reference SSISDB\JAMS_Logging\JAMS_Logs\[.|JAMS_Logging/JAMS_Logging_Env] already exists.'


print ''
 -- Reference Project Parameter Mapping CS_Con_IAFramework-->Con_IAFramework
print ' - Reference Project Parameter Mapping CS_Con_IAFramework-->Con_IAFramework'
print ' - Clear Reference Package or Project Parameter Mapping CS_Con_IAFramework-->Con_IAFramework'
Exec [SSISDB].[catalog].[clear_object_parameter_value] 
     @object_type = 20 -- project 
   , @object_name = N'JAMS_Logs' 
   , @parameter_name = N'CS_Con_IAFramework' 
   , @folder_name = N'JAMS_Logging' 
   , @project_name = N'JAMS_Logs' 

print ' - Reference Project Parameter Mapping CS_Con_IAFramework-->Con_IAFramework cleared'
print ''
print ' - Add or Update Reference Package or Project Parameter Mapping CS_Con_IAFramework-->Con_IAFramework'
Exec [SSISDB].[catalog].[set_object_parameter_value] 
     @object_type = 20 -- project 
   , @parameter_name = N'CS_Con_IAFramework' 
   , @object_name = N'JAMS_Logs' 
   , @folder_name = N'JAMS_Logging' 
   , @project_name = N'JAMS_Logs' 
   , @parameter_value = N'Con_IAFramework' 
   , @value_type = 'R' 

print ' - Reference Project Parameter Mapping CS_Con_IAFramework-->Con_IAFramework added / updated'
print ''


 -- Reference Project Parameter Mapping CS_Con_JAMS-->Con_JAMS
print ' - Reference Project Parameter Mapping CS_Con_JAMS-->Con_JAMS'
print ' - Clear Reference Package or Project Parameter Mapping CS_Con_JAMS-->Con_JAMS'
Exec [SSISDB].[catalog].[clear_object_parameter_value] 
     @object_type = 20 -- project 
   , @object_name = N'JAMS_Logs' 
   , @parameter_name = N'CS_Con_JAMS' 
   , @folder_name = N'JAMS_Logging' 
   , @project_name = N'JAMS_Logs' 

print ' - Reference Project Parameter Mapping CS_Con_JAMS-->Con_JAMS cleared'
print ''
print ' - Add or Update Reference Package or Project Parameter Mapping CS_Con_JAMS-->Con_JAMS'
Exec [SSISDB].[catalog].[set_object_parameter_value] 
     @object_type = 20 -- project 
   , @parameter_name = N'CS_Con_JAMS' 
   , @object_name = N'JAMS_Logs' 
   , @folder_name = N'JAMS_Logging' 
   , @project_name = N'JAMS_Logs' 
   , @parameter_value = N'Con_JAMS' 
   , @value_type = 'R' 

print ' - Reference Project Parameter Mapping CS_Con_JAMS-->Con_JAMS added / updated'
print ''

